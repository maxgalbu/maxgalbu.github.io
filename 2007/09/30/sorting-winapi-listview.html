<!doctype html>
<html>
  <head>
        <html lang="en-US">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>
        
            WinAPI Listview tutorials - How to sort a listview | Max's Cookies
      
    </title>
    <meta name="description" content="
     
    ">

    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=PT+Serif&display=swap">

    <!-- SEO Plugin -->
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>WinAPI Listview tutorials - How to sort a listview | Max’s Cookies</title>
<meta name="generator" content="Jekyll v4.1.0" />
<meta property="og:title" content="WinAPI Listview tutorials - How to sort a listview" />
<meta name="author" content="Massimo Galbusera" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="These are very old tutorials I made when I was testing Windows API back in 2007 when I was young and full of energy. Please be aware that they can be waaaaay out of date!" />
<meta property="og:description" content="These are very old tutorials I made when I was testing Windows API back in 2007 when I was young and full of energy. Please be aware that they can be waaaaay out of date!" />
<link rel="canonical" href="https://maxgalbu.github.io/2007/09/30/sorting-winapi-listview.html" />
<meta property="og:url" content="https://maxgalbu.github.io/2007/09/30/sorting-winapi-listview.html" />
<meta property="og:site_name" content="Max’s Cookies" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2007-09-30T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="WinAPI Listview tutorials - How to sort a listview" />
<meta name="twitter:site" content="@ilgalbu" />
<meta name="twitter:creator" content="@Massimo Galbusera" />
<script type="application/ld+json">
{"description":"These are very old tutorials I made when I was testing Windows API back in 2007 when I was young and full of energy. Please be aware that they can be waaaaay out of date!","@type":"BlogPosting","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://maxgalbu.github.io/assets/img/logo.jpg"},"name":"Massimo Galbusera"},"url":"https://maxgalbu.github.io/2007/09/30/sorting-winapi-listview.html","headline":"WinAPI Listview tutorials - How to sort a listview","dateModified":"2007-09-30T00:00:00+00:00","datePublished":"2007-09-30T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://maxgalbu.github.io/2007/09/30/sorting-winapi-listview.html"},"author":{"@type":"Person","name":"Massimo Galbusera"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- Google Analytics -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-169412235-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-169412235-1');
</script>

    <!-- End Google Analytics -->

    <script>
       document.addEventListener("DOMContentLoaded", function(){
         document.getElementById("default").click();
       });

       function showTab(evt, tabId) {
         // Declare all variables
         var i, tabcontent, tablinks;

         // Get all elements with class="tabcontent" and hide them
         tabcontent = document.getElementsByClassName("tabcontent");
         for (i = 0; i < tabcontent.length; i++) {
           tabcontent[i].style.display = "none";
         }

         // Get all elements with class="tablinks" and remove the class "active"
         tablinks = document.getElementsByClassName("tablinks");
         for (i = 0; i < tablinks.length; i++) {
           tablinks[i].className = tablinks[i].className.replace(" active", "");
         }

         // Show the current tab, and add an "active" class to the button that opened the tab
         document.getElementById(tabId).style.display = "block";
         evt.currentTarget.className += " active";
       }
     </script>
  </head>

<body>

  <div class="container">
    <header id="header">
	<div id = site_title>
		<a href="https://maxgalbu.github.io/">
			<h1>Max's Cookies</h1>
		</a>
		
	</div>

	<div id="subheader">
		
		<nav class="pages">
<a href="/about.html">About</a>

<a href="/archive.html">Archive</a>
</nav>
		
		
		<nav class="social">
			
  
    <a href="https://www.github.com/maxgalbu" target="_blank" id="github"><i class="fab fa-github" aria-hidden="true"></i></a>
  
   

  
    <a href="https://twitter.com/ilgalbu" target="_blank" id="twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
  
   

  
    <a href="https://www.linkedin.com/in/massimo-galbusera-7922a9b2/" target="_blank" id="linkedin"><i class="fab fa-linkedin" aria-hidden="true"></i></a>
  
   

  
  
    <a href="/feed.xml" target="_blank" id="rss"><i class="fas fa-rss" aria-hidden="true"></i></a>
   

		</nav>
		
	</div>
</header>

    <div class="post-container">
      <article id = "post">
        <h2 id = "post-title">WinAPI Listview tutorials - How to sort a listview</h2>

  
  <div class = "post-info">
    <span>
        <i class="far fa-calendar" aria-hidden="true"></i> <span>30 Sep 2007</span> - <i class="far fa-clock"></i> 


  
  
    5 minute read
  

    </span>
  </div>
  
        <p><span class="alert y">These are very old tutorials I made when I was testing Windows API back in 2007 when I was young and full of energy. Please be aware that they can be <ins>waaaaay</ins> out of date!</span></p>

<h2 id="how-to-sort-a-listview">How to sort a listview</h2>

<h3 id="download">Download</h3>

<ul>
  <li><a href="/assets/download/columnsortimage/columnsortimage_demo.rar">Demo (executable)</a></li>
  <li><a href="/assets/download/columnsortimage/columnsortimage_example.rar">Source (plus a C::B project)</a></li>
  <li><a href="/assets/download/columnsortimage/uparrow.bmp">Up Arrow BMP</a></li>
  <li><a href="/assets/download/columnsortimage/downarrow.bmp">Down Arrow BMP</a></li>
</ul>

<p>Sort a listview is easy. Although you can manually move items, change the items’ image and things like that, Windows helps you by providing two messages to be sent to the listview: <a href="http://msdn2.microsoft.com/en-us/library/bb761227.aspx" target="_blank"><code class="language-plaintext highlighter-rouge">LVM_SORTITEMS</code></a> and <a href="http://msdn2.microsoft.com/en-us/library/bb761228.aspx" target="_blank"><code class="language-plaintext highlighter-rouge">LVM_SORTITEMSEX</code></a> (which you can easily use through the macros <a href="http://msdn2.microsoft.com/en-us/library/ms671382.aspx" target="_blank"><code class="language-plaintext highlighter-rouge">ListView_SortItems</code></a> and <a href="http://msdn2.microsoft.com/en-us/library/bb761228.aspx" target="_blank"><code class="language-plaintext highlighter-rouge">ListView_SortItemsEx</code></a>).</p>

<p>Both messages shares a callback function, whose prototype is:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">CALLBACK</span> <span class="nf">CompareFunc</span><span class="p">(</span><span class="n">LPARAM</span> <span class="n">lParam1</span><span class="p">,</span> <span class="n">LPARAM</span> <span class="n">lParam2</span><span class="p">,</span> <span class="n">LPARAM</span> <span class="n">lParamSort</span><span class="p">);</span>
</code></pre></div></div>

<p>This callback function is where you decide if an item (whose date is in the <strong>lParam1</strong> parameter) must go first or after another item (<strong>lParam2</strong> parameter). The third parameter of the callback function is the parameter you pass in your call to <code class="language-plaintext highlighter-rouge">SendMessage(LVM_SORTITEMS(EX))</code> or <code class="language-plaintext highlighter-rouge">ListView_SortItems(Ex)</code>. You decide the value of this parameter. The procedure goes like this:</p>

<ol>
  <li>You send <code class="language-plaintext highlighter-rouge">LVM_SORTITEMS</code> or <code class="language-plaintext highlighter-rouge">LVM_SORTITEMSEX</code> to the listview, passing the callback function you created and a parameter you want</li>
  <li>Windows calls for each couple of items your callback functions</li>
  <li>Inside the callback function, you do the comparison and return
    <ul>
      <li>-1: if the first item should precede the second</li>
      <li>0: if the two items are the same</li>
      <li>1: if the second item should precede the first</li>
    </ul>
  </li>
</ol>

<h3 id="the-difference-between-lvm_sortitems-and-lvm_sortitemsex">The difference between <code class="language-plaintext highlighter-rouge">LVM_SORTITEMS</code> and <code class="language-plaintext highlighter-rouge">LVM_SORTITEMSEX</code></h3>

<p>The two messages share the same callback and both requires an user-defined variable. The difference is that the first (<code class="language-plaintext highlighter-rouge">LVM_SORTITEMS</code>) pass to the callback functions the user-defined value you used in the <strong>lparam</strong> member of the <strong>LVITEM</strong> structure. This is useful only in rare cases, that is why you’ll usually want to use the <code class="language-plaintext highlighter-rouge">LVM_SORTITEMSEX</code>. This message makes Windows send the index of the item to the callback, so you can get the text of the item using <code class="language-plaintext highlighter-rouge">LVM_GETITEMTEXT</code> message or any other data through the <code class="language-plaintext highlighter-rouge">LVM_GETITEM</code> message.</p>

<h3 id="the-callback-function">The callback function</h3>

<p>As said before, the older versions of Windows needs an image to be set manually in the header: two images, actually, a <strong>down</strong> and an <strong>up arrow</strong> bitmaps. These two bitmaps are available in the download section of this page. It’s your choice where to put them: i’ve included them in the executable and i use LoadImage and IDs to load those images. Change it if you put them elsewhere.</p>

<p>Here’s the complete function code:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">ListView_SetHeaderSortImage</span><span class="p">(</span><span class="n">HWND</span> <span class="n">listView</span><span class="p">,</span> <span class="kt">int</span> <span class="n">columnIndex</span><span class="p">,</span> <span class="n">BOOL</span> <span class="n">isAscending</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">HWND</span> <span class="n">header</span> <span class="o">=</span> <span class="n">ListView_GetHeader</span><span class="p">(</span><span class="n">listView</span><span class="p">);</span>
    <span class="n">BOOL</span> <span class="n">isCommonControlVersion6</span> <span class="o">=</span> <span class="n">IsCommCtrlVersion6</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">columnCount</span> <span class="o">=</span> <span class="n">Header_GetItemCount</span><span class="p">(</span><span class="n">header</span><span class="p">);</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">columnCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">HDITEM</span> <span class="n">hi</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
        <span class="n">hi</span><span class="p">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">HDI_FORMAT</span> <span class="o">|</span> <span class="p">(</span><span class="n">isCommonControlVersion6</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">HDI_BITMAP</span><span class="p">);</span>
        <span class="n">Header_GetItem</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hi</span><span class="p">);</span>
        
        <span class="c1">//Set sort image to this column</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">columnIndex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">isCommonControlVersion6</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">hi</span><span class="p">.</span><span class="n">fmt</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">HDF_SORTDOWN</span><span class="o">|</span><span class="n">HDF_SORTUP</span><span class="p">);</span>
                <span class="n">hi</span><span class="p">.</span><span class="n">fmt</span> <span class="o">|=</span> <span class="n">isAscending</span> <span class="o">?</span> <span class="n">HDF_SORTUP</span> <span class="o">:</span> <span class="n">HDF_SORTDOWN</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">UINT</span> <span class="n">bitmapID</span> <span class="o">=</span> <span class="n">isAscending</span> <span class="o">?</span> <span class="n">IDB_UPARROW</span> <span class="o">:</span> <span class="n">IDB_DOWNARROW</span><span class="p">;</span>
                
                <span class="c1">//If there's a bitmap, let's delete it.</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">hi</span><span class="p">.</span><span class="n">hbm</span><span class="p">)</span>
                    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">hi</span><span class="p">.</span><span class="n">hbm</span><span class="p">);</span>
                
                <span class="n">hi</span><span class="p">.</span><span class="n">fmt</span> <span class="o">|=</span> <span class="n">HDF_BITMAP</span><span class="o">|</span><span class="n">HDF_BITMAP_ON_RIGHT</span><span class="p">;</span>
                <span class="n">hi</span><span class="p">.</span><span class="n">hbm</span> <span class="o">=</span> <span class="p">(</span><span class="n">HBITMAP</span><span class="p">)</span><span class="n">LoadImage</span><span class="p">(</span><span class="n">GetModuleHandle</span><span class="p">(</span><span class="nb">NULL</span><span class="p">),</span> <span class="n">MAKEINTRESOURCE</span><span class="p">(</span><span class="n">bitmapID</span><span class="p">),</span> <span class="n">IMAGE_BITMAP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">LR_LOADMAP3DCOLORS</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">//Remove sort image (if exists)</span>
        <span class="c1">//from other columns.</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">isCommonControlVersion6</span><span class="p">)</span>
                <span class="n">hi</span><span class="p">.</span><span class="n">fmt</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">HDF_SORTDOWN</span><span class="o">|</span><span class="n">HDF_SORTUP</span><span class="p">);</span>
            <span class="k">else</span><span class="o">&lt;</span>
            <span class="p">{</span>
                <span class="c1">//If there's a bitmap, let's delete it.</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">hi</span><span class="p">.</span><span class="n">hbm</span><span class="p">)</span>
                    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">hi</span><span class="p">.</span><span class="n">hbm</span><span class="p">);</span>
                
                <span class="n">hi</span><span class="p">.</span><span class="n">mask</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">HDI_BITMAP</span><span class="p">;</span>
                <span class="n">hi</span><span class="p">.</span><span class="n">fmt</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">HDF_BITMAP</span><span class="o">|</span><span class="n">HDF_BITMAP_ON_RIGHT</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="n">Header_SetItem</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hi</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="the-function-explained">The function, explained</h3>

<p>The function has this prototype:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">ListView_SetHeaderSortImage</span><span class="p">(</span><span class="n">HWND</span> <span class="n">listView</span><span class="p">,</span> <span class="kt">int</span> <span class="n">columnIndex</span><span class="p">,</span> <span class="n">BOOL</span> <span class="n">isAscending</span><span class="p">);</span>
</code></pre></div></div>

<p>So, whenever you call this function, you must pass:</p>

<ul>
  <li>the listview window handle</li>
  <li>the index of the column that is sorted</li>
  <li>whether or not the order is ascending (up arrow displayed) or descending (down arrow displayed)</li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">LVN_COLUMNCLICK</code> notification handler should be the right place to put this function.</p>

<p>Inside the function now:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">HWND</span> <span class="n">header</span> <span class="o">=</span> <span class="n">ListView_GetHeader</span><span class="p">(</span><span class="n">listView</span><span class="p">);</span>  
<span class="n">BOOL</span> <span class="n">isCommonControlVersion6</span> <span class="o">=</span> <span class="n">IsCommCtrlVersion6</span><span class="p">();</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">LVCOLUMN</code> structure is useless, because it doesn’t let you set all the header’s features. So i’m going to use the header messages (<code class="language-plaintext highlighter-rouge">HDM_X</code>) sent to the header window, obtained through <code class="language-plaintext highlighter-rouge">ListView_GetHeader</code>. I store the BOOL that is TRUE or FALSE whether the application has commctrl version 6 loaded, to avoid unnecessary overhead by calling the function more than once inside this function.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">columnCount</span> <span class="o">=</span> <span class="n">Header_GetItemCount</span><span class="p">(</span><span class="n">header</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">columnCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The function doesn’t store neither require from you the last ordered column index, so i need to iterate through all the existing columns to add the image to the correct column index and remove it from all the other column. And, since there are always few columns, this loop doesn’t halt your program.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">HDITEM</span> <span class="n">hi</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="n">hi</span><span class="p">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">HDI_FORMAT</span> <span class="o">|</span> <span class="p">(</span><span class="n">isCommonControlVersion6</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">HDI_BITMAP</span><span class="p">);</span>
<span class="n">Header_GetItem</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hi</span><span class="p">);</span>
</code></pre></div></div>

<p>Here i retrieve the column props from the header through <code class="language-plaintext highlighter-rouge">Header_GetItem</code>. With commctrl 6, the only thing that changes is the format; without it i need to retrieve and set the bitmap too. So,</p>

<ul>
  <li>version &gt;= 6: <code class="language-plaintext highlighter-rouge">HDI_FORMAT</code></li>
  <li>version &lt; 6: <code class="language-plaintext highlighter-rouge">HDI_FORMAT|HDI_BITMAP</code></li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">columnIndex</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isCommonControlVersion6</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">hi</span><span class="p">.</span><span class="n">fmt</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">HDF_SORTDOWN</span><span class="o">|</span><span class="n">HDF_SORTUP</span><span class="p">);</span>
        <span class="n">hi</span><span class="p">.</span><span class="n">fmt</span> <span class="o">|=</span> <span class="n">isAscending</span> <span class="o">?</span> <span class="n">HDF_SORTUP</span> <span class="o">:</span> <span class="n">HDF_SORTDOWN</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">UINT</span> <span class="n">bitmapID</span> <span class="o">=</span> <span class="n">isAscending</span> <span class="o">?</span> <span class="n">IDB_UPARROW</span> <span class="o">:</span> <span class="n">IDB_DOWNARROW</span><span class="p">;</span>
        
        <span class="c1">//If there's a bitmap, let's delete it.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">hi</span><span class="p">.</span><span class="n">hbm</span><span class="p">)</span>
            <span class="n">DeleteObject</span><span class="p">(</span><span class="n">hi</span><span class="p">.</span><span class="n">hbm</span><span class="p">);</span>
        
        <span class="n">hi</span><span class="p">.</span><span class="n">fmt</span> <span class="o">|=</span> <span class="n">HDF_BITMAP</span><span class="o">|</span><span class="n">HDF_BITMAP_ON_RIGHT</span><span class="p">;</span>
        <span class="n">hi</span><span class="p">.</span><span class="n">hbm</span> <span class="o">=</span> <span class="p">(</span><span class="n">HBITMAP</span><span class="p">)</span><span class="n">LoadImage</span><span class="p">(</span><span class="n">GetModuleHandle</span><span class="p">(</span><span class="nb">NULL</span><span class="p">),</span> <span class="n">MAKEINTRESOURCE</span><span class="p">(</span><span class="n">bitmapID</span><span class="p">),</span> <span class="n">IMAGE_BITMAP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">LR_LOADMAP3DCOLORS</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The column index corresponds to the index you passed to the function, so this column is being sorted. As before, two ways:</p>

<ul>
  <li>version &gt;= 6
    <ul>
      <li>since i don’t know which flag was set before, i remove the both of them</li>
      <li>set the correct format flag for the order basing upon the value of <strong>isAscending</strong>: <code class="language-plaintext highlighter-rouge">HDF_SORTUP</code> or <code class="language-plaintext highlighter-rouge">HDF_SORTDOWN</code>. Windows will draw the order image in the header.</li>
    </ul>
  </li>
  <li>version &lt; 6
    <ul>
      <li>delete the old bitmap if it exists</li>
      <li>append the format flags: <code class="language-plaintext highlighter-rouge">HDF_BITMAP</code> (again :) and <code class="language-plaintext highlighter-rouge">HDF_BITMAP_ON_RIGHT</code> (since the bitmap should be to the right of the text)</li>
      <li>load and set the correct bitmap basing on the value of <code class="language-plaintext highlighter-rouge">isAscending</code> with LoadImage and the special flag <code class="language-plaintext highlighter-rouge">LR_LOADMAP3DCOLORS</code>. This flag replace the gray color ( RGB(192,192,192) ) with the corresponding system color (<code class="language-plaintext highlighter-rouge">COLOR_3DFACE</code>) that is also the background color of each column in the header.</li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">else</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isCommonControlVersion6</span><span class="p">)</span>
        <span class="n">hi</span><span class="p">.</span><span class="n">fmt</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">HDF_SORTDOWN</span><span class="o">|</span><span class="n">HDF_SORTUP</span><span class="p">);</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">//If there's a bitmap, let's delete it.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">hi</span><span class="p">.</span><span class="n">hbm</span><span class="p">)</span>
            <span class="n">DeleteObject</span><span class="p">(</span><span class="n">hi</span><span class="p">.</span><span class="n">hbm</span><span class="p">);</span>
        
        <span class="n">hi</span><span class="p">.</span><span class="n">mask</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">HDI_BITMAP</span><span class="p">;</span>
        <span class="n">hi</span><span class="p">.</span><span class="n">fmt</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">HDF_BITMAP</span><span class="o">|</span><span class="n">HDF_BITMAP_ON_RIGHT</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>All the other column indexex aren’t being sorted, so i remove the image/flags from them (even if they don’t have it).</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Header_SetItem</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hi</span><span class="p">);</span>
</code></pre></div></div>

<p>Finally, i apply the changes through <code class="language-plaintext highlighter-rouge">Header_SetItem</code> and the modified <code class="language-plaintext highlighter-rouge">HDITEM structure</code>.</p>


      </article>
    </div>
    
      <div class="categories">
    <span><p>Categories:</p>
    
    
      <a href="
      /categories/#winapi">WinAPI</a>
      &nbsp; 
    
      <a href="
      /categories/#programming">Programming</a>
       
    
  </span>
</div>
    

    

    
      <section class="disqus">
    <p id="load-comments" onclick="loadDisqus()">Load Comments</p>
    <div id="disqus_thread"></div>

    <script id="loadDisqus" type="text/javascript">
      var disqus_loaded = false;
      var disqus_shortname = "maxgalbu";
      var disqus_identifier = "/2007/09/30/sorting-winapi-listview.html";
      function loadDisqus() {
        var e = document.createElement('script'); 
        e.type = 'text/javascript'; 
        e.async = true;
        e.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(e);
        document.getElementById("load-comments").style.display = "none";
      };
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments.</a></noscript>
</section>
    
  </div><footer class= "footer">
    <p>Copyright© Massimo Galbusera 2020. All right reserved. Theme designed by <a href="https://alessiofranceschi.me/">Alessio Franceschi</a>.</p>
</footer>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</body>
</html>
